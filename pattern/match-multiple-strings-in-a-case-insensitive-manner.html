<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta http-equiv=content-security-policy content="frame-src https://www.buymeacoffee.com; style-src 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.rawgit.com 'self'; script-src 'sha256-imF8GK2COF0FH3k9XZpauIkklApKaavS3S5BhNoXbio=' 'sha256-cZF+Uee35x4Ntz8KyGTRwEq74vIlvLgxfBw7ARDKY0o=' 'sha256-nP0EI9B9ad8IoFUti2q7EQBabcE5MS5v0nkvRfUbYnM=' https://cdn.jsdelivr.net https://cdnjs.buymeacoffee.com https://code.jquery.com https://cdnjs.cloudflare.com https://cdn.rawgit.com https://pagead2.googlesyndication.com 'self'; img-src https://repository-images.githubusercontent.com https://cdn.buymeacoffee.com https://img.shields.io 'self'"><meta name=keywords content="Django,web,programming,antipattern,pattern,troubleshooting,software design,regex,string-matching,django-orm,django-models,django-views"><meta name=author content="Willem Van Onsem"><meta name=description content="A set of Django (anti)patterns: patterns and things to avoid when building a web application with Django."><meta name=twitter:image:src content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:title content="Match multiple strings in a case-insensitive manner"><meta name=og:image content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:image:alt content="A prohibition sign in the Django color scheme."><meta name=og:image:type content="image/png"><meta name=og:type content="website"><link rel=stylesheet href=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/template.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/default.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css><script src=https://code.jquery.com/jquery-3.5.1.min.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.cookie.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.hoverIntent.minified.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link href=/style.css rel=stylesheet><link href=https://cdn.rawgit.com/ryangrose/easy-pandoc-templates/948e28e5/css/elegant_bootstrap.css rel=stylesheet><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/jquery.sticky-kit.js></script><script data-ad-client=ca-pub-9962024266760159 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script src=/script.js></script><link rel=icon href=/favicon.ico type=image/x-icon><meta name=generator content="pandoc"><title>Match multiple strings in a case-insensitive manner &lsaquo; pattern &lsaquo; Django antipatterns</title></head><body><a class=github-fork-ribbon href=https://github.com/hapytex/django-antipatterns data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a><article><div class="navbar navbar-static-top"><div class=navbar-inner><div class=container><nav aria-label=section><ol class=breadcrumb><li class=breadcrumb-item><a href=/><i class="fas fa-home"></i></a><li class=breadcrumb-item><a href=/pattern.html><i class="fas fa-shapes"></i>&nbsp;
pattern</a><li class="breadcrumb-item active" aria-current=page>Match multiple strings in a case-insensitive manner</ol></nav><ul class="nav pull-right doc-info"></ul></div></div></div><div class=container><div class=row><div class=span12><p>It often happens that we have a list of strings, and we want to obtain model objects where a certain field contains at least one of the given strings. Often this is also checked in a case-<em>in</em>sensitive way, such that <code>'apple'</code> and <code>'APPLE'</code> are considered equivalent.<p>Usually we have a list of items that we want to match with that field, for example:<pre class=python3><code>fruits = [&#39;apple&#39;, &#39;blueberry&#39;, &#39;coconut&#39;, &#39;dragonfruit&#39;]</code></pre><p>an for example look for <code>Post</code> objects where the <code>content</code> field contains at least one of these elements in a case-<em>in</em>sensitive way.<h1 id=what-problems-are-solved-with-this>What problems are solved with this?</h1><p>We can not make use of the <a href=https://docs.djangoproject.com/en/dev/ref/models/querysets/#in><strong><code>__in</code></strong> lookup [Django-doc]</a> since this will only match items that contain exactly the name of one fruit in case-sensitive way. This thus means that the content should be <code>'apple'</code>, not <s><code>'APPLE'</code></s>, <s><code>'Apple'</code></s>, <s><code>'An apple'</code></s>, etc.:<pre class=python3><code>Post.objects.filter(
    content__in=fruits
)</code></pre><p>will thus only retrieve posts with one word: the name of a fruit defined in the <code>fruits</code> list.<p>With the pattern described here, we can perform a case-insensitive match where we can decide if the item should start with the name of a fruit, end with the name of a fruit, or simply contain the name of a fruit.<h1 id=what-does-this-pattern-look-like>What does this pattern look like?</h1><p>Regular expressions can be used to look for multiple items with one expression. The only thing that we have to do is convert our <code>fruits</code> list to a regular expression that will simultaneously look for an <code>'apple'</code>, <code>'blueberry'</code>, etc. Such regular expression looks like <code>'(apple|blueberry|coconut|dragonfruit)'</code>. If we want to restrict this further such that the content <em>begins</em> with an element of the <code>fruits</code> list, we can use a caret (<code>^</code>): <code>'^(apple|blueberry|coconut|dragonfruit)'</code> will only match contents that start with one of the elements. We can also make use of the end anchor <code>$</code> such that the content <em>ends</em> with the given item.<p>There are however some problems we will need to overcome. It is for example possible that the name of the <code>fruits</code> contain a dot (<code>.</code>), pipe character (<code>|</code>), etc. If we join items simply together, then it is possible that we thus will match different items. One can use the <a href=https://docs.python.org/3/library/re.html#re.escape><strong><code>escape(…)</code></strong> function [Python-doc]</a> to escape the items in the <code>fruits</code> list such that tokens that have a special meaning in a regex are escaped.<p>If we want to match case-insensitive, this means we should use the <a href=https://docs.djangoproject.com/en/dev/ref/models/querysets/#iregex><strong><code>__iregex</code></strong> lookup [Django-doc]</a>. If we thus have a list <code>fruits</code> with the name of the fruits, we can construct a regex and filter with:<pre class=python3><code>from re import escape

myregex = f'^({&quot;|&quot;.join(<b>escape(</b>fruit<b>)</b> for fruit in fruits)})$'

Post.objects.filter(
    <b>content__iregex=myregex</b>
)</code></pre><p>The <code>^</code> and/or <code>$</code> can be removed if it is not required that the item is found at start/end of the <code>content</code> respectively.</p><script nonce data-name=BMC-Widget src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=hapytex data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting." data-color=#FFDD00 data-position=Right data-x_margin=18 data-y_margin=18></script></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script>anchors.options={placement:'left',visible:'hover',icon:'¶'};anchors.add('h1,h2,h3');</script></article></body></html>